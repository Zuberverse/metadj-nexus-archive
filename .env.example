# MetaDJ Nexus — Environment Variables (Example)
#
# Copy this file to .env.local for local development:
#   cp .env.example .env.local
#
# Then fill in your API keys where marked with placeholders.
#
# Notes:
# - Never commit real secrets to git.
# - Boolean flags use "true"/"false" (some also accept 1/0).
# - Next.js hot-reloads .env.local automatically — no restart needed after adding keys.
#

# =============================================================================
# QUICK START — Minimum required for local dev
# =============================================================================
# 1. Copy this file to .env.local
# 2. Add at least ONE AI provider key (OpenAI recommended as default)
# 3. Run: npm run dev
# 4. Open: https://localhost:8100
#
# MetaDJai will work with any single provider. Add more for failover + model switching.

# -----------------------------------------------------------------------------
# Core
# -----------------------------------------------------------------------------
NODE_ENV=development
PORT=8100

# -----------------------------------------------------------------------------
# Public URLs
# -----------------------------------------------------------------------------
# Local dev uses localhost; production uses the real domain
NEXT_PUBLIC_APP_URL=https://localhost:8100

# Production overrides (set in hosting environment)
# NEXT_PUBLIC_APP_URL=https://metadjnexus.ai
# NEXT_PUBLIC_PREVIEW_URL=https://preview.metadjnexus.ai

# -----------------------------------------------------------------------------
# MetaDJai — AI Provider API Keys
# -----------------------------------------------------------------------------
# MetaDJai supports 4 AI providers with automatic failover.
#
# FALLBACK ORDER: OpenAI → Google → Anthropic → xAI
# - If the selected provider fails (rate limit, timeout, error), the next available
#   provider in priority order is tried automatically when AI_FAILOVER_ENABLED=true.
# - Users can switch providers via the model dropdown in MetaDJai chat UI.
# - Only providers with configured API keys appear in the dropdown.
#
# MINIMUM: Configure at least ONE provider for MetaDJai to work.
# RECOMMENDED: Configure all 4 for full redundancy and user choice.

# OpenAI (GPT-5.2) — Priority 1 (default)
# Get key: https://platform.openai.com/api-keys
# Docs: https://platform.openai.com/docs/models/gpt-5.2-chat-latest
OPENAI_API_KEY=sk-your-openai-key-here
PRIMARY_AI_MODEL=gpt-5.2-chat-latest

# Google (Gemini 3 Flash) — Priority 2
# Get key: https://aistudio.google.com/apikey
# Docs: https://ai.google.dev/gemini-api/docs/gemini-3
GOOGLE_API_KEY=AIza-your-google-key-here
GOOGLE_AI_MODEL=gemini-3-flash-preview

# Anthropic (Claude Haiku 4.5) — Priority 3
# Get key: https://console.anthropic.com/settings/keys
# Docs: https://docs.anthropic.com/en/docs/about-claude/models
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key-here
ANTHROPIC_AI_MODEL=claude-haiku-4-5-20251001

# xAI (Grok 4.1 Fast Non-Reasoning) — Priority 4
# Get key: https://console.x.ai/
# Docs: https://x.ai/api
XAI_API_KEY=xai-your-xai-key-here
XAI_AI_MODEL=grok-4-1-fast-non-reasoning

# Default provider (openai | google | anthropic | xai)
# This is the starting provider; users can switch via UI
AI_PROVIDER=openai

# Speech-to-text for Journal voice input
# Uses OpenAI's transcription model (requires OPENAI_API_KEY)
# Docs: https://platform.openai.com/docs/models/gpt-4o-mini-transcribe
OPENAI_TRANSCRIBE_MODEL=gpt-4o-mini-transcribe-2025-12-15

# -----------------------------------------------------------------------------
# AI Infrastructure & Failover
# -----------------------------------------------------------------------------
# Failover: If primary provider fails, automatically try next in priority order
AI_FAILOVER_ENABLED=true

# Response caching (reduces API calls for repeated queries)
# Disable for development to always get fresh responses
AI_CACHE_ENABLED=false

# Timeouts (milliseconds) — adjust if you experience timeouts
AI_TIMEOUT_STREAM=60000
AI_TIMEOUT_CHAT=30000
AI_TIMEOUT_TRANSCRIBE=45000
AI_TIMEOUT_TOOLS=90000
AI_REQUEST_TIMEOUT_MS=30000

# Cache settings (when AI_CACHE_ENABLED=true)
AI_CACHE_TTL_MS=300000
AI_CACHE_MAX_SIZE=100

# AI spending alerts (optional)
# Defaults: $1/hour, $10/day, 80% warning threshold
AI_SPENDING_HOURLY_LIMIT=1
AI_SPENDING_DAILY_LIMIT=10
AI_SPENDING_WARNING_THRESHOLD=0.8
AI_SPENDING_BLOCK_ON_LIMIT=false

# -----------------------------------------------------------------------------
# Dream / Daydream — WHIP Streaming to Livepeer
# -----------------------------------------------------------------------------
# The Dream feature uses WHIP (WebRTC-HTTP Ingestion Protocol) to stream
# AI-generated video from the browser to Livepeer's infrastructure.
#
# Architecture:
# 1. Browser captures webcam/screen via WHIPClient (src/lib/streaming/whip-client.ts)
# 2. WHIP proxy route (/api/daydream/streams/[streamId]/whip) forwards to Livepeer
# 3. Daydream API processes the stream with AI effects
# 4. Output stream is delivered via Livepeer's CDN
#
# Get key: Contact Daydream/Livepeer for API access
DAYDREAM_API_KEY=your-daydream-key-here
# Public preview gate (production requires explicit enable)
DAYDREAM_PUBLIC_ENABLED=false
DAYDREAM_API_GATEWAY=https://api.daydream.live
DAYDREAM_WHIP_ALLOWED_HOSTS=daydream.live,sdaydream.live,livepeer.com,livepeer.studio,livepeer.cloud,lp-playback.studio,localhost,127.0.0.1
DAYDREAM_WHIP_ALLOW_DEV=true

# -----------------------------------------------------------------------------
# Rate Limiting — Upstash Redis (optional)
# -----------------------------------------------------------------------------
# Production: Use Upstash Redis for distributed rate limiting across instances
# Development: Leave commented; falls back to in-memory rate limiting
#
# Get credentials: https://console.upstash.com/
# UPSTASH_REDIS_REST_URL=https://...
# UPSTASH_REDIS_REST_TOKEN=...
#
# RATE_LIMIT_FAIL_CLOSED controls behavior when Redis is unavailable:
# - false (default): Fail-open — requests allowed if Redis unreachable (degraded security)
# - true: Fail-closed — requests blocked if Redis unreachable (recommended for production)
#
# SECURITY RECOMMENDATION: Set to true in production multi-instance deployments
# to prevent rate limit bypass during Redis outages. For single-instance or dev,
# false is acceptable as in-memory fallback provides protection.
RATE_LIMIT_FAIL_CLOSED=false

# -----------------------------------------------------------------------------
# Analytics — Plausible (optional)
# -----------------------------------------------------------------------------
# Privacy-focused analytics for production
# NEXT_PUBLIC_PLAUSIBLE_DOMAIN=metadjnexus.ai
# NEXT_PUBLIC_PLAUSIBLE_API_HOST=https://plausible.io

# -----------------------------------------------------------------------------
# Media Storage
# -----------------------------------------------------------------------------
# Storage provider selection: 'replit' (legacy) or 'r2' (Cloudflare R2)
# R2 is recommended for production — zero egress fees, S3-compatible API
STORAGE_PROVIDER=replit

# --- Cloudflare R2 (recommended for production) ---
# S3-compatible object storage with zero egress fees
# Get credentials: Cloudflare Dashboard > R2 > Manage R2 API Tokens
# Bucket uses prefixes for logical separation: music/, visuals/
#
# R2_ACCOUNT_ID=your-cloudflare-account-id
# R2_ACCESS_KEY_ID=your-r2-access-key-id
# R2_SECRET_ACCESS_KEY=your-r2-secret-access-key
# R2_BUCKET=metadj-nexus-media

# --- Replit App Storage (legacy) ---
# Falls back to public/audio directory when not configured
#
# MUSIC_BUCKET_ID=replit-objstore-...
# VISUALS_BUCKET_ID=replit-objstore-...

# Legacy alias (still supported)
# AUDIO_BUCKET_ID=replit-objstore-...

# Development fallback buckets (used when primary buckets unset)
# DEV_FALLBACK_MUSIC_BUCKET_ID=replit-objstore-...
# DEV_FALLBACK_VISUALS_BUCKET_ID=replit-objstore-...

# SECURITY: Allow fallback buckets in production (not recommended)
# ALLOW_OBJECT_STORAGE_FALLBACK=false

# -----------------------------------------------------------------------------
# Logging — Webhook Forwarding (optional)
# -----------------------------------------------------------------------------
# Forward logs to external service for monitoring
# LOGGING_WEBHOOK_URL=https://...
# LOGGING_SHARED_SECRET=... (>=32 chars)
# LOGGING_CLIENT_KEY=... (>=32 chars; must match NEXT_PUBLIC_LOGGING_CLIENT_KEY)
# NEXT_PUBLIC_LOGGING_CLIENT_KEY=... (>=32 chars; must match LOGGING_CLIENT_KEY)

# -----------------------------------------------------------------------------
# Internal Monitoring (optional)
# -----------------------------------------------------------------------------
# Protects internal health endpoints (/api/health/ai, /api/health/providers)
# INTERNAL_API_SECRET=your-internal-health-secret

# -----------------------------------------------------------------------------
# Dev-only Security
# -----------------------------------------------------------------------------
# Required to enable admin endpoints like /api/dev/clear-rate-limits
# DEV_SECRET=your-dev-secret-for-admin-endpoints
# DEV_API_TOKEN=... (optional additional security layer)

# -----------------------------------------------------------------------------
# Platform-provided (usually set automatically by hosting)
# -----------------------------------------------------------------------------
# Replit
# REPLIT_ENV=
# REPLIT_DEPLOYMENT=
# REPLIT_APP_URL=
# REPL_ID=

# Vercel
# VERCEL_ENV=
